<%@ page session="false" buffer="none" %> 
<%@ page trimDirectiveWhitespaces="true" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>
<%@ page import="com.pepsico.pepsicouniversity.utils.PepsicoUniversityCommonHelper" %>
<%@ page import="com.pepsico.pepsicouniversity.theme.property.ThemePropertyLoader" %>
<%@ page import="com.pepsico.pepsicouniversity.constants.CommonConstants.EnvironmentConstants" %>
<%@ page import="com.pepsico.pepsicouniversity.theme.constants.PepsicoUniversityThemeConstants.PropertyConstants" %>
<%@ page import="com.pepsico.pepsicouniversity.theme.constants.PepsicoUniversityThemeConstants" %>
<%@ include file="../includePortalTaglibs.jspf" %>

<%-- This file displays navigation for a given type --%>

<%
String propertyLdrPath = PepsicoUniversityCommonHelper.returnPropertyFilePath(PepsicoUniversityThemeConstants.FOLDER_PATH,PepsicoUniversityThemeConstants.THEME_PROP_FILE);

ThemePropertyLoader propertyLdr = ThemePropertyLoader.getInstance(propertyLdrPath);
			
%>


<%-- lazy load the selection path array --%>
<portal-core:lazy-set var="selectionPath" elExpression="wp.selectionModel.selectionPath"/>

<%-- define the startLevel, endLevel, root CSS class and root accessibility label for each type of navigation --%>

	<c:set var="startLevel" value="3"/>
	<c:set var="endLevel" value="3"/>
	
		
	<%-- loop through from startLevel to endLevel, outputing a navigation for each level --%>
		<c:forEach var="node" items="${selectionPath}" varStatus="status" begin="${startLevel}" end="${endLevel}" step="1">
			<c:set var="curLevel" value="${startLevel + (status.count-1)}"/> 
			<%-- print out navigation if the selection path is not empty and children exist --%>
	
			<c:if test="${(fn:length(selectionPath) > curLevel) && wp.navigationModel.hasChildren[selectionPath[curLevel]]}">
			<div class="secondary-navigation">
				<c:set var="parentNode" value="${node}" scope="request" />
				<div class="mob-sec-nav">
					<span class="nav-mark">${fn:toUpperCase(parentNode)}<span class="arrow"></span></span>
				</div>
				<div class="aside sec-nav">
					<ul>
						<c:forEach var="childnode" items="${wp.navigationModel.children[selectionPath[curLevel]]}">
							<c:if test="${!childnode.metadata['portal.page.Hidden']}">
								<c:choose>
									<c:when test="${childnode.metadata['page.metadata.inpopup']}">
										<c:set var="target" value="_blank" />
									</c:when>
									<c:otherwise>
										<c:set var="target" value="_self" />
									</c:otherwise>
								</c:choose> 
								
								<c:set var="hasChildren" value="${wp.navigationModel.hasChildren[childnode]}" />
								
								<c:choose>
									<c:when test="${hasChildren}">
										<c:set var="url" value="#" />
									</c:when>
									<c:otherwise>
										<c:set var="url" value="?uri=nm:oid:${wp.identification[childnode]}" />
									</c:otherwise>
								</c:choose>
								<c:set var="nodeTitle" value="${childnode.title}"/>
								<%
								String spanClass ="";
								String id="";
								if(null!=propertyLdr){
									com.ibm.wps.engine.el.TitleBean nodeTitle = (com.ibm.wps.engine.el.TitleBean)pageContext.getAttribute("nodeTitle");
									if(null!=nodeTitle){
										String title = nodeTitle.toString();
										if(title.contains(PropertyConstants.HOME)){
											spanClass=propertyLdr.getProperty(PropertyConstants.PROP_HOME);
											
											}else if(title.contains(PropertyConstants.SCHOOLS)){
												spanClass=propertyLdr.getProperty(PropertyConstants.PROP_SCHOOLS);
												id=propertyLdr.getProperty(PropertyConstants.PROP_ID_SCHOOLS);
											}else if(title.contains(PropertyConstants.COURSE)){
												spanClass=propertyLdr.getProperty(PropertyConstants.PROP_COURSE);
									//[April 2018 Secondary Naviagtion  Release starts]	
												
											}else if(title.contains(PropertyConstants.KEY_CAPABILITIES))
											
											{
												spanClass=propertyLdr.getProperty(PropertyConstants.PROP_KEY_CAPAB);
												id=propertyLdr.getProperty(PropertyConstants.PROP_ID_KEY_CAPAB);
									//[April 2018 Secondary Naviagtion  Release ends]
											}
											// [July Release - Senthil - Starts]
											else if(title.contains(PropertyConstants.PHASES)){
												spanClass=propertyLdr.getProperty(PropertyConstants.PROP_SCHOOLS);
												id=propertyLdr.getProperty(PropertyConstants.PROP_ID_SCHOOLS);
											}
											// [July Release - Senthil - Ends]
											// [Sep Release - Senthil - Starts]
											else if(title.toLowerCase().contains(PropertyConstants.CONTACT.toLowerCase())){
												spanClass=propertyLdr.getProperty(PropertyConstants.PROP_CONTACT);
											}
											// [Sep Release - Senthil - Ends]
											// [For AMENA Release in Nov/2015 - Senthil - Starts]
											else if(title.toLowerCase().contains(PropertyConstants.SECTOR.toLowerCase())){
												spanClass=propertyLdr.getProperty(PropertyConstants.PROP_SECTOR);
											}
											// [For AMENA Release in Nov/2015 - Senthil - Ends]
											else{
												spanClass=propertyLdr.getProperty(PropertyConstants.PROP_RESOURCES);
											}
										}
								}
								
								 %>
								 
								 <%--  [Sep release- Senthil - Starts] --%>
								
								 <c:if test="${hasChildren}">
										<c:choose>
											<c:when test="${childnode.metadata['portal.page.show.sidenav'] == 'true'}">
												<c:set var="showSideNav" value="true"/>
											</c:when>
											<c:otherwise>
												<c:set var="showSideNav" value="false" />
											</c:otherwise>
										</c:choose>
								 </c:if>
								 
								 <% 
								 	String showSideNav = (String) pageContext.getAttribute("showSideNav");
								 	if("true".equalsIgnoreCase(showSideNav)) {
										spanClass=propertyLdr.getProperty(PropertyConstants.PROP_SCHOOLS);
										id=propertyLdr.getProperty(PropertyConstants.PROP_ID_SCHOOLS);
									}
								 %>
								 
								 <c:set var="showSideNav" value="false" />
								 
								 <%--  [Sep release- Senthil - Ends] --%>
								 
								<li class="<%=spanClass%>">
									<a href="${url}" id="<%=id%>" target="${target}"><span class="icons"></span><span><c:out value="${childnode.title}"/></span></a>
								</li>
									<c:if test="${hasChildren}">
									<li class="sec-sub-nav" id="sn_schools_list">
										<ul>
										<c:forEach var="secondLevelChildNode" items="${wp.navigationModel.children[childnode]}">
											<c:if test="${!secondLevelChildNode.metadata['portal.page.Hidden']}">
												<c:choose>
													<c:when test="${secondLevelChildNode.metadata['page.metadata.inpopup']}">
														<c:set var="target" value="_blank" />
													</c:when>
													<c:otherwise>
														<c:set var="target" value="_self" />
													</c:otherwise>
												</c:choose>
												<li>
													<a href="?uri=nm:oid:${wp.identification[secondLevelChildNode]}" target="${target}"><span><c:out value="${secondLevelChildNode.title}"/></span></a>
												</li>	
											</c:if>
										</c:forEach>
										</ul>	
									</li>
								</c:if>
							</c:if>
						</c:forEach>	
					</ul>
					<span class="toggle-menu expanded"></span>
				</div>
			</div>
			</c:if>
			
		</c:forEach>

